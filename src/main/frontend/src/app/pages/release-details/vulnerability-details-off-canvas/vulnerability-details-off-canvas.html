@if (vulnerability) {
  <app-off-canvas [title]="vulnerability.cveId" (closeCanvas)="onClose()">
    <div class="off-canvas-body">
      <div class="vulnerability-header">
        <span class="severity-badge" [ngClass]="getSeverityClass(vulnerability.severity)">
          {{ vulnerability.severity }}
        </span>
      </div>

      @if (vulnerability.impactScore !== null && vulnerability.impactScore !== undefined) {
        <div class="impact-section">
          <h5>Impact Assessment</h5>
          <div class="impact-score-display">
            <span class="impact-label">Impact Score:</span>
            <span class="impact-value">{{ vulnerability.impactScore }}</span>
          </div>
          @if (vulnerability.impactDescription) {
            <div class="impact-description">{{ vulnerability.impactDescription }}</div>
          }
        </div>
      }

      <div class="description-container">
        <div
          class="cve-description"
          [class.expanded]="isDescriptionExpanded"
          [innerHTML]="getMarkdownHtml(vulnerability.description)"
        ></div>
        @if (showSeeMoreButton) {
          <button class="see-more-button" (click)="toggleDescription()">
            {{ isDescriptionExpanded ? 'See less' : 'See more' }}
          </button>
        }
      </div>

      @if (vulnerability.cwes && vulnerability.cwes.length > 0) {
        <div class="cwes-section">
          <h5>CWEs</h5>
          <div class="cwe-list">
            @for (cwe of vulnerability.cwes; track cwe) {
              <a target="_blank" rel="noopener noreferrer" class="cwe-badge" [href]="getCweUrl(cwe)">
                {{ cwe }}
              </a>
            }
          </div>
        </div>
      }
    </div>
  </app-off-canvas>
}
