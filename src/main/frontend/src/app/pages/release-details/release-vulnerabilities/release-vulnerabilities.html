<div class="vulnerabilities-container">
  <div class="cve-list">
    <div class="cve-list-header">
      <h3 class="vulnerabilities-title">Vulnerabilities ({{ sortedVulnerabilities.length }})</h3>
      <div>
        <h4 class="last-scanned-label">Last Scanned</h4>
        <p>
          @if (lastScanned) {
            {{ lastScanned | date: 'mediumDate' }}
          } @else {
            Never
          }
        </p>
      </div>
    </div>

    @if (sortedVulnerabilities.length === 0) {
      <p class="no-vulnerabilities">No vulnerabilities found for this release.</p>
    } @else {
      @for (vulnerability of sortedVulnerabilities; track vulnerability.cveId) {
        <div
          class="cve-item"
          tabindex="0"
          role="button"
          [class.selected]="selectedVulnerability?.cveId === vulnerability.cveId && isOffCanvasOpen"
          (click)="selectVulnerability(vulnerability)"
          (keydown.enter)="selectVulnerability(vulnerability)"
          (keydown.space)="selectVulnerability(vulnerability)"
        >
          <div class="cve-header">
            <span class="cve-id">{{ vulnerability.cveId }}</span>
            <span class="severity-badge" [ngClass]="getSeverityClass(vulnerability.severity)">
              {{ vulnerability.severity }}
            </span>
          </div>
          <div class="cve-scores">
            <div class="cve-score">CVSS Score: {{ formatCvssScore(vulnerability.cvssScore) }}</div>
            @if (vulnerability.impactScore !== null && vulnerability.impactScore !== undefined) {
              <div class="impact-score">Impact Score: {{ formatCvssScore(vulnerability.impactScore) }}</div>
            }
          </div>
        </div>
      }
    }
  </div>

  @if (isOffCanvasOpen) {
    <app-vulnerability-details-off-canvas
      [vulnerability]="selectedVulnerability"
      (closeVulnerabilityCanvas)="closeOffCanvas()"
    />
  }
</div>
