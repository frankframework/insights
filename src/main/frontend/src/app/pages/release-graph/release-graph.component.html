<div class="graph-container">
  @if (!isLoading) {
    <svg
      #svgElement
      id="svgElement"
      [attr.viewBox]="viewBox"
      (wheel)="onWheel($event)"
      (mousedown)="onMouseDown($event)"
      (mouseup)="onMouseUp()"
      (mousemove)="onMouseMove($event)"
      (mouseleave)="onMouseUp()"
      (touchstart)="onTouchStart($event)"
      (touchmove)="onTouchMove($event)"
      (touchend)="onTouchEnd()"
      (touchcancel)="onTouchEnd()"
    >
      <g [attr.transform]="'translate(' + translateX + ',' + translateY + ') scale(' + scale + ')'">
        @for (link of allLinks; track link) {
          <path
            [attr.data-cy]="'link-' + link.id"
            [attr.d]="getCustomPath(link)"
            [class.dotted]="link.isGap || link.isFadeIn"
            [class.fade-in]="link.isFadeIn"
          />
        }

        @for (releaseNode of releaseNodes; track releaseNode) {
          <g
            class="release-node"
            [attr.data-cy]="'node-' + releaseNode.label"
            [attr.transform]="'translate(' + releaseNode.position.x + ',' + releaseNode.position.y + ')'"
            (click)="openReleaseNodeDetails(releaseNode.id)"
          >
            <circle r="20" [attr.fill]="releaseNode.color" />
            <text y="-30">
              {{ releaseNode.label }}
            </text>
          </g>
        }

        @for (skipNode of skipNodes; track skipNode.id) {
          <g
            class="skip-node"
            [attr.data-cy]="'skip-node-' + skipNode.id"
            [attr.transform]="'translate(' + skipNode.x + ',' + skipNode.y + ')'"
            (click)="openSkipNodeModal(skipNode.id)"
          >
            <circle r="20" class="skip-circle" />
            <text y="2" class="skip-text">{{ skipNode.skippedCount }}</text>
          </g>
        }
      </g>
    </svg>

    <div class="branch-labels-sticky">
      @for (stickyLabel of stickyBranchLabels; track stickyLabel.label) {
        <span class="sticky-branch-label" [style.top.px]="stickyLabel.screenY - 75">{{ stickyLabel.label }}</span>
      }
    </div>

    <app-release-catalogus />

    @if (dataForSkipModal) {
      <app-skipped-versions-modal
        [skipNode]="dataForSkipModal"
        [releases]="releases"
        (closed)="closeSkipNodeModal()"
        (versionClicked)="onSkippedVersionClick($event)"
      />
    }
  } @else {
    <app-loader />
  }
</div>
