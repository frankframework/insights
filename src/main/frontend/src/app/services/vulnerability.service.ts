import { Injectable, inject } from '@angular/core';
import { Observable } from 'rxjs';
import { AppService } from '../app.service';

export const VulnerabilitySeverities = {
  CRITICAL: 'CRITICAL',
  HIGH: 'HIGH',
  MEDIUM: 'MEDIUM',
  LOW: 'LOW',
  NONE: 'NONE',
  UNKNOWN: 'UNKNOWN',
} as const;

export type VulnerabilitySeverity = (typeof VulnerabilitySeverities)[keyof typeof VulnerabilitySeverities];

export interface Vulnerability {
  cveId: string;
  severity: VulnerabilitySeverity;
  cvssScore: number;
  description: string;
  cwes: string[];
}

@Injectable({
  providedIn: 'root',
})
export class VulnerabilityService {
  private appService = inject(AppService);

  getVulnerabilitiesByReleaseId(releaseId: string): Observable<Vulnerability[]> {
    return this.appService.get<Vulnerability[]>(this.appService.createAPIUrl(`vulnerabilities/release/${releaseId}`));
  }
}
